- name: WebサーバーのLAMP環境セットアップ
  hosts: webserver
  become: true
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Apache(httpd)のインストール
      dnf:
        name: httpd
        state: present

    - name: Apacheサービスの起動と自動起動設定
      service:
        name: httpd
        state: started
        enabled: yes

    - name: PHPと必要なモジュールのインストール
      dnf:
        name:
          - php
          - php-mysqlnd  # MariaDB/MySQL用のPHPモジュール
          - php-xml
          - php-mbstring
        state: present

    - name: SELinuxの設定変更（Apache用）
      seboolean:
        name: httpd_can_network_connect
        state: yes
        persistent: yes

    - name: ファイアウォールでHTTPを許可
      firewalld:
        service: http
        permanent: yes
        state: enabled
        immediate: yes

    - name: Apache(httpd)の再起動
      service:
        name: httpd
        state: restarted
